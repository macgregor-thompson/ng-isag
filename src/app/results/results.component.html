<div class="container">

  <ng-container *ngIf="stateService.year.scoresConfirmed || stateService.isAdmin; else noResults">
    <mat-card class="isag-card courses-card">
      <mat-card-header>
        <mat-card-title>
          <div>{{stateService.year.year}} Results</div>
        </mat-card-title>
        <div class="fill-remaining-space"></div>
        <div class="select-button-header">
          <button mat-raised-button color="primary" (click)="openAddEditScorecardDialog()" class="right-16"
                  *ngIf="stateService.isAdmin">
            <mat-icon>add</mat-icon>
            SCORECARD
          </button>
        </div>
      </mat-card-header>

      <mat-list class="isag-list player-results-list">
        <mat-list-item class="list-item no-hover"
                       *ngFor="let card of scorecards | orderBy: 'rank';
                       let odd = odd; let first = first; let last = last; let index = index"
                       [disableRipple]="true" [class.odd-item]="odd" [class.first-place]="first"
                       [class.last-place]="last">

          <div class="list-ranking">{{(card.tied ? 'T' : '') + card.rank}}</div>

          <div class="player-divs">
            <div class="player">
              <div class="name">{{card.team.playerA.firstName + ' ' + card.team.playerA.lastName}}</div>
              <mat-icon *ngIf="first" svgIcon="jacket" class="isag-icon"></mat-icon>
              <mat-icon *ngIf="last" svgIcon="bra" class="isag-icon"></mat-icon>
            </div>

            <div class="player">
              <div class="name">{{card.team.playerB.firstName + ' ' + card.team.playerB.lastName}}</div>
              <mat-icon *ngIf="first" svgIcon="jacket" class="isag-icon"></mat-icon>
              <mat-icon *ngIf="last" svgIcon="bra" class="isag-icon"></mat-icon>
            </div>
          </div>

          <div class="list-total">
            {{card && course && getTotalScore(card.totalNetScore - (course.frontNinePar + course.backNinePar))}}
          </div>

          <!--  <div class="bidder">
              <div>{{card.team.winningBidder}}</div>
            </div>-->

        </mat-list-item>
      </mat-list>
    </mat-card>

    <mat-card class="isag-card courses-card" *ngIf="firstPlaceTeam">
      <mat-card-header>
        <mat-card-title>
          <div>{{stateService.year.year}} Calcutta Winnings</div>
        </mat-card-title>
      </mat-card-header>
      <div class="winning-cards">
        <mat-card>
          <h3 class="place">1<sup>st</sup> Place</h3>
          <h1>{{firstPlaceTeam?.winningBidder}}</h1>
          <h3>{{moneyForWinnings * stateService.year.firstPlacePercentage / 100 | currency}}</h3>
        </mat-card>
        <mat-card>
          <h3 class="place">2<sup>nd</sup> Place</h3>
          <ng-container *ngIf="secondPLaceTeams.length === 1; else multipleSecond">
            <h1>{{secondPLaceTeams[0]?.winningBidder}}</h1>
            <h3>{{moneyForWinnings * stateService.year.secondPlacePercentage / 100 | currency}}</h3>
          </ng-container>
          <ng-template #multipleSecond>
            <div class="multiple-winners">
              <h1 *ngFor="let team of secondPLaceTeams">{{team.winningBidder}}</h1>
            </div>
            <h3>
              {{ secondPlaceMoney | currency}}/{{ secondPLaceTeams.length }} = {{secondPlaceMoney / secondPLaceTeams.length | currency}} each
            </h3>
          </ng-template>
        </mat-card>
        <mat-card *ngIf="secondPLaceTeams.length === 1">
          <h3 class="place">3<sup>rd</sup> Place</h3>
          <h1 *ngIf="thirdPLaceTeams.length === 1; else multipleThird">{{secondPLaceTeams[0]?.winningBidder}}</h1>
          <ng-template #multipleThird>
            <h2 *ngFor="let team of secondPLaceTeams">{{team.winningBidder}}</h2>
          </ng-template>
          <h3>{{moneyForWinnings * stateService.year.thirdPlacePercentage / 100 | currency}}</h3>
        </mat-card>
      </div>
    </mat-card>

    <mat-card class="isag-card courses-card">
      <mat-card-header>
        <mat-card-title>
          <div>{{stateService.year.year}} Team Scores</div>
        </mat-card-title>
        <div class="fill-remaining-space"></div>

        <mat-slide-toggle color="primary" [(ngModel)]="stateService.year.scoresConfirmed"
                          class="confirm-scores"
                          (ngModelChange)="updateScoresConfirmed($event)"
                          [disabled]="!stateService.isAdmin">Scores Confirmed
        </mat-slide-toggle>

      </mat-card-header>

      <mat-card-content *ngIf="course" class="team-card-content">
        <isag-course-card [course]="course" [rankings]="true">
          <ng-container *ngFor="let card of scorecards | orderBy: 'rank'; let even = even;">
            <tr [class.even]="even">
              <th class="left-th">
                <div class="ranking">
                  {{(card.tied ? 'T' : '') + card.rank}}
                </div>
              </th>
              <th class="team-names-th" [class.isAdmin]="stateService.isAdmin" isagStopPropagation
                  [stopPropagation]="stateService.isAdmin">
                <button mat-stroked-button class="edit-card-btn" color="primary"
                        (click)="openAddEditScorecardDialog(card)">
                  <mat-icon>edit</mat-icon>
                  Edit Scorecard
                </button>
                <div class="player-names">
                  <div class="name">{{card.team.playerA.firstName + ' ' + card.team.playerA.lastName}}</div>
                  <div class="name">{{card.team.playerB.firstName + ' ' + card.team.playerB.lastName}}</div>
                </div>

              </th>
              <td *ngFor="let hole of course.frontNine | keyValue">
                <div class="score" [ngClass]="scoreClass(card.teamNetScores[hole.key], hole.value.par)">
                  {{card.teamNetScores[hole.key]}}
                </div>
              </td>
              <th>{{card.frontNineNetScore}}</th>
              <td *ngFor="let hole of course.backNine | keyValue">
                <div class="score" [ngClass]="scoreClass(card.teamNetScores[hole.key], hole.value.par)">
                  {{card.teamNetScores[hole.key]}}
                </div>
              </td>
              <th>{{card.backNineNetScore}}</th>
              <th>{{card.totalNetScore}}</th>
            </tr>
          </ng-container>

        </isag-course-card>

      </mat-card-content>
    </mat-card>

    <mat-card class="isag-card courses-card" *ngIf="course && playerScores">
      <mat-card-header>
        <mat-card-title>
          <div>{{stateService.year.year}} Individual Scores</div>
        </mat-card-title>
      </mat-card-header>

      <mat-card-content>
        <isag-course-card [course]="course" [showNet]="true">
          <ng-container  *ngFor="let scores of playerScores; let even = even;">
            <tr isag-player-scores [class.even]="even"
                name="{{scores.player.firstName + ' ' + scores.player.lastName}}"
                [scores]="scores"
                [frontNine]="course.frontNine"
                [backNine]="course.backNine"></tr>
          </ng-container>


        </isag-course-card>

      </mat-card-content>
    </mat-card>

  </ng-container>


  <ng-template #noResults>
    <mat-card class="isag-card">
      <isag-alert>
        <div class="no-results">
          <p>Results for {{stateService.year.year}} have not been finalized yet. Please check back later.</p>
          <p>Visit the <strong><a routerLink="/leaderboard">Leaderboard</a></strong> for unconfirmed results.</p>
        </div>
      </isag-alert>
    </mat-card>
  </ng-template>
</div>

